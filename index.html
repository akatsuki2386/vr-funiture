<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>VR Furniture Planner</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    
    <style>
      /* パネルUIのCSS */
      #vr-ui-container {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10;
        pointer-events: none; /* 初期はクリック不可 */
      }
      .panel {
        background: rgba(51, 51, 51, 0.7);
        border-radius: 10px;
        color: white;
        padding: 20px;
        width: 300px;
        height: 400px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        align-items: center;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        pointer-events: auto; /* ボタンはクリック可能に */
      }
      .panel button {
        width: 80%;
        padding: 10px;
        margin: 10px 0;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        pointer-events: auto;
      }
      #main-menu, #furniture-menu {
        display: none;
      }
    </style>
    
    <script>
      const furnitureData = [
          { id: 'sofa', name: 'ソファ', model: 'https://cdn.aframe.io/models/gltf/a-frame-3d-model/obj/sofa.obj' },
          { id: 'table', name: 'テーブル', model: 'https://cdn.aframe.io/models/gltf/a-frame-3d-model/obj/table.obj' },
          { id: 'chair', name: '椅子', model: 'https://cdn.aframe.io/models/gltf/a-frame-3d-model/obj/chair.obj' },
      ];

      document.addEventListener('DOMContentLoaded', () => {
        const vrScene = document.querySelector('a-scene');
        const handSelectionUI = document.getElementById('hand-selection-ui');
        const vrUiContainer = document.getElementById('vr-ui-container');
        const mainMenu = document.getElementById('main-menu');
        const furnitureMenu = document.getElementById('furniture-menu');

        // VRモードに移行した後の処理
        vrScene.addEventListener('enter-vr', () => {
          handSelectionUI.style.display = 'none';
          vrUiContainer.style.display = 'block';
          mainMenu.style.display = 'flex';
          
          const handedness = localStorage.getItem('handedness');
          const panelUI = document.querySelector('.panel');

          // 利き手に応じてパネルUIを配置
          if (handedness === 'right') {
            panelUI.style.left = 'auto';
            panelUI.style.right = '5%';
          } else {
            panelUI.style.left = '5%';
            panelUI.style.right = 'auto';
          }
        });

        // 利き手選択のイベントリスナー
        document.getElementById('right-hand-btn').addEventListener('click', () => {
          localStorage.setItem('handedness', 'right');
        });
        
        document.getElementById('left-hand-btn').addEventListener('click', () => {
          localStorage.setItem('handedness', 'left');
        });

        // パネルUIの画面遷移ロジック
        document.getElementById('add-button').addEventListener('click', () => {
            mainMenu.style.display = 'none';
            furnitureMenu.style.display = 'flex';
        });
        
        document.getElementById('back-button').addEventListener('click', () => {
            furnitureMenu.style.display = 'none';
            mainMenu.style.display = 'flex';
        });

        furnitureData.forEach(furniture => {
            const button = document.getElementById(`furniture-button-${furniture.id}`);
            if (button) {
                button.addEventListener('click', () => {
                    console.log(`${furniture.name}が選択されました！`);
                });
            }
        });
      });
    </script>
  </head>
  <body>
    <div id="hand-selection-ui" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; background: rgba(0, 0, 0, 0.7); padding: 5vw; border-radius: 10px; text-align: center; color: white; font-family: sans-serif; box-sizing: border-box; max-width: 90vw;">
      <h1>VR家具配置シミュレーション</h1>
      <p>利き手はどちらですか？</p>
      <button id="right-hand-btn" style="padding: 1vw 2vw; margin: 1vw; font-size: 3vw;">右利き</button>
      <button id="left-hand-btn" style="padding: 1vw 2vw; margin: 1vw; font-size: 3vw;">左利き</button>
    </div>

    <div id="vr-ui-container">
      <div id="main-menu" class="panel">
        <button id="add-button" style="background-color: #5cb85c;">モデルの追加</button>
        <button id="help-button" style="background-color: #f0ad4e;">動作の説明</button>
        <button id="exit-button" style="background-color: #d9534f;">シミュレーションの終了</button>
      </div>
      <div id="furniture-menu" class="panel">
        <button id="furniture-button-sofa" style="background-color: #5bc0de;">ソファ</button>
        <button id="furniture-button-table" style="background-color: #5bc0de;">テーブル</button>
        <button id="furniture-button-chair" style="background-color: #5bc0de;">椅子</button>
        <button id="back-button" style="background-color: #f0ad4e;">戻る</button>
      </div>
    </div>

    <a-scene 
      webxr="requiredFeatures: local-floor, dom-overlay" 
      renderer="colorManagement: true;"
      vr-mode-ui="enterVRButton: #right-hand-btn, #left-hand-btn; enabled: true;"
      dom-overlay="root: #vr-ui-container"
    >
      <a-assets>
      </a-assets>

      <a-entity id="left-hand" hand-controls="hand: left; model: true;"></a-entity>
      <a-entity id="right-hand" hand-controls="hand: right; model: true;"></a-entity>

      <a-entity camera look-controls wasd-controls></a-entity>
      
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
  </body>
</html>
